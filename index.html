<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Atomic Fizz">
<meta name="theme-color" content="#001a00">
<title>Atomic Fizz · Vault 77 – 50 LOCATIONS</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<style>
@import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono:wght@400;700&display=swap');
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
html,body{height:100%;overflow:hidden;background:#000;color:#0f0;font-family:'Share Tech Mono',monospace;-webkit-user-select:none;user-select:none;}
.term{flex:1;display:flex;flex-direction:column;background:#001a00;border:3px solid #0f0;box-shadow:0 0 40px #0f0;padding:15px;border-radius:12px;position:relative;text-align:center;min-height:0;overflow-y:auto;max-height:100vh;margin:8px;}
.term::before{content:"VAULT 777 · ATOMIC FIZZ · v3.4 LIVE";position:absolute;top:-14px;left:12px;background:#000;padding:0 16px;font-size:12px;letter-spacing:4px;color:#0f0;}
h1{font-size:clamp(2.8rem,8vw,5rem);margin:10px 0;text-shadow:0 0 30px #0f0;animation:f 2s infinite;}
button{background:transparent;border:2px solid #0f0;color:#0f0;padding:14px 20px;font-size:clamp(1.3rem,4.5vw,1.8rem);margin:10px 6px;cursor:pointer;box-shadow:0 0 25px #0f0;transition:.25s;letter-spacing:2px;border-radius:10px;min-height:56px;font-weight:700;}
button:active{background:#0f0;color:#000;transform:scale(0.96);box-shadow:0 0 60px #0f0;}
button:disabled{opacity:0.35;cursor:not-allowed;}
.status{font-size:clamp(1.2rem,4vw,1.7rem);margin:15px 0;}
.char{background:rgba(0,40,0,0.85);padding:15px;margin:18px 0;border-left:5px solid #0f0;border-radius:10px;font-size:clamp(1rem,3vw,1.3rem);}
.level-bar,.health-bar{background:#111;border:2px solid #ff9500;padding:8px;margin:10px 0;border-radius:8px;}
.level-fill,.health-fill{height:24px;background:linear-gradient(90deg,#ff9500,#ffff00,#0f0);border-radius:5px;transition:width .4s ease;}
.health-fill{background:linear-gradient(90deg,#f66,#ff6200,#0f0);}
#mapContainer{flex:1;display:none;position:relative;margin:12px 0;border-radius:12px;overflow:hidden;}
#map{height:100%;border:4px solid #0f0;box-shadow:0 0 40px #0f0;border-radius:12px;}
#nearby{position:absolute;top:10px;left:10px;right:10px;background:rgba(0,0,0,0.92);padding:14px;border:2px solid #ff6200;border-radius:10px;color:#ff9500;font-size:clamp(0.9rem,2.8vw,1.2rem);z-index:1000;max-height:140px;overflow-y:auto;}
.overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.97);z-index:9999;justify-content:center;align-items:center;flex-direction:column;padding:20px;text-align:center;}
.cratebox{width:300px;height:300px;max-width:90vw;max-height:90vh;background:#111;border:6px solid #ff6200;border-radius:20px;display:flex;align-items:center;justify-content:center;font-size:clamp(5rem,20vw,10rem);animation:s 0.9s infinite;}
.raid-alert{background:#300;border:5px solid #f66;padding:30px;border-radius:15px;max-width:90vw;}
.combat-log{background:#111;padding:15px;margin:15px 0;border:2px solid #f66;border-radius:8px;max-height:180px;overflow-y:auto;font-size:0.9rem;}
.death-screen{background:#000;border:6px solid #f66;padding:35px;border-radius:18px;max-width:90vw;}
.level-up{background:#001a00;border:6px solid #0f0;padding:35px;border-radius:18px;animation:levelGlow 2s infinite;}
.stimpak-btn{background:#0f0!important;color:#000!important;border-color:#0f0!important;box-shadow:0 0 40px #0f0;}
@keyframes f{0%,100%{opacity:1}50%{opacity:0.5}}
@keyframes s{0%,100%{transform:translate(0)}30%{transform:translate(-10px,10px)rotate(-5deg)}70%{transform:translate(10px,-10px)rotate(5deg)}}
@keyframes levelGlow{0%,100%{box-shadow:0 0 40px #0f0}50%{box-shadow:0 0 80px #0f0,0 0 120px #ffff00}}
.leaflet-touch .leaflet-bar a{width:40px!important;height:40px!important;line-height:40px!important;font-size:20px!important;}
@media(max-width:768px){.term{margin:4px;padding:10px;border-width:2px;}}
</style>
</head>
<body>
<div class="term" id="mainContainer">
  <h1>ATOMIC FIZZ</h1>
  <p style="font-size:clamp(1.4rem,5vw,2.5rem);margin:12px 0;">50 REAL FALLOUT LOCATIONS • LEVELING • LOOT • SURVIVE</p>
  
  <div style="background:rgba(0,50,0,0.7);padding:18px;margin:20px 0;border-left:5px solid #0f0;border-radius:10px;">
    <b>LOOT ORANGE DOTS → GAIN CAPS & XP → BUY STIMPAKS → NEVER DIE</b>
  </div>

  <button id="connectBtn">CONNECT WALLET</button>
  <div class="status" id="status">Status: <span style="color:#f66;">NOT CONNECTED</span></div>

  <div class="char" id="character" style="display:none;">
    Wastelander • LVL <span id="lvl" class="level-up">1</span> • XP: <span id="xpText">0</span>/<span id="xpMax">100</span><br>
    <div class="level-bar"><div class="level-fill" id="xpBar" style="width:0%"></div></div>
    HP: <span id="hpText">100/100</span>
    <div class="health-bar"><div class="health-fill" id="hpBar" style="width:100%"></div></div>
    CAPS: <span id="caps">0</span>
  </div>

  <div id="gearInventory" style="display:none;background:rgba(0,40,0,0.8);padding:16px;margin:16px 0;border-left:5px solid #ff6200;border-radius:10px;">
    <h3 style="color:#ff6200;margin-bottom:10px;">GEAR</h3>
    <div id="gearList"><p style="color:#666;">No gear equipped</p></div>
  </div>

  <div id="stimpakShop" style="display:none;background:rgba(0,40,0,0.8);padding:16px;margin:16px 0;border-left:5px solid #0f0;border-radius:10px;">
    <h3 style="color:#0f0;">STIMPAK SHOP</h3>
    <div style="display:flex;gap:12px;flex-wrap:wrap;justify-content:center;margin:12px 0;">
      <button id="buyCommon">Stimpak<br><small>100 CAPS • +60 HP</small></button>
      <button id="buySuper">Super Stimpak<br><small>500 CAPS • FULL HEAL</small></button>
    </div>
    <div id="stimpakInventory" style="margin-top:12px;font-size:1.1rem;">Stimpaks: 0</div>
  </div>

  <button id="gpsBtn" disabled style="background:linear-gradient(45deg,#ff6200,#ff9500);color:#000;font-weight:900;">
     50 LOCATION SCANNER
  </button>

  <div id="mapContainer">
    <div id="map"></div>
    <div id="nearby">Loading 50 Fallout locations...</div>
  </div>

  <button id="backBtn" onclick="backToMain()" style="display:none;background:linear-gradient(45deg,#f66,#ff4444);color:#000;font-weight:900;">
    BACK TO TERMINAL
  </button>
</div>

<!-- OVERLAYS -->
<div class="overlay" id="lootOverlay"><div class="cratebox">LOOT</div><h2 id="lootResult">+50 CAPS • +20 XP</h2><button onclick="closeLoot()">CLAIMED</button></div>
<div class="overlay" id="levelUpOverlay" class="level-up"><div style="font-size:10rem;">STAR</div><h2>LEVEL UP!</h2><p>Level <span id="newLevel">2</span></p><p style="color:#ff9500;">+20 Max HP • +5 ATK • +3 DEF</p><button onclick="closeLevelUp()">CONTINUE</button></div>
<div class="overlay" id="deathOverlay"><div class="death-screen"><div style="font-size:12rem;">SKULL</div><h2>YOU DIED</h2><p>Rads got you...</p><button class="stimpak-btn" id="reviveBtn">REVIVE WITH STIMPAK</button><p style="color:#f66;margin-top:15px;">No stimpaks = Game Over</p></div></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
// ———————————————————————— GLOBALS ————————————————————————
let map, userMarker, claimed = new Set();
let wallet = null;

let player = {
  level: 1,
  xp: 0,
  xpToNext: 100,
  maxHp: 100,
  hp: 100,
  caps: 0,
  stimpaks: [],        // ["Stimpak", "Super Stimpak", ...]
  gear: []
};

const locations = [{n:"Goodsprings (Pioneer Saloon)",lat:35.8324,lng:-115.4320},
      {n:"Primm (Buffalo Bill's)",lat:35.6145,lng:-115.3845},
      {n:"Nipton Trading Post",lat:35.46667,lng:-115.27222},
      {n:"Boulder City Hotel",lat:35.97750,lng:-114.83639},
      {n:"Hoover Dam",lat:36.016045,lng:-114.737839},
      {n:"Lucky 38 (The Strat)",lat:36.147247,lng:-115.156029},
      {n:"New Vegas Strip (Bellagio)",lat:36.112740,lng:-115.174301},
      {n:"Freeside (Fremont St)",lat:36.170719,lng:-115.143929},
      {n:"Red Rock Canyon",lat:36.13514,lng:-115.4283},
      {n:"Bonnie Springs Ranch",lat:36.06007,lng:-115.45027},
      {n:"Callville Bay Marina",lat:36.14400,lng:-114.72200},
      {n:"Black Mountain",lat:35.9310,lng:-115.0440},
      {n:"Sloan Station",lat:35.94361,lng:-115.21722},
      {n:"Jean Airport",lat:35.7677,lng:-115.3245},
      {n:"Searchlight",lat:35.46434,lng:-114.91844},
      {n:"McCarran Airport",lat:36.0801,lng:-115.1522},
      {n:"Nellis AFB",lat:36.2361,lng:-115.0342},
      {n:"Helios One (Nevada Solar One)",lat:35.7580,lng:-114.9530},
      {n:"Old Mormon Fort",lat:36.1694,lng:-115.1305},
      {n:"Ultra-Luxe (Caesars Palace)",lat:36.0972,lng:-115.1787},
      {n:"Gomorrah (Dunes site)",lat:36.1100,lng:-115.1720},
      {n:"Silver Rush (Golden Nugget)",lat:36.1498,lng:-115.1390},
      {n:"Atomic Wrangler (Vegas Vic)",lat:36.1499,lng:-115.1383},
      {n:"Repconn Test Site (Pepcon)",lat:36.0360,lng:-115.0880},
      {n:"Novac (Little A'Le'Inn)",lat:37.6447,lng:-115.7461},
      {n:"Nelson Ghost Town",lat:35.4189,lng:-114.7133},
      {n:"Rhyolite Ghost Town",lat:36.9033,lng:-116.8283},
      {n:"Mt. Charleston",lat:36.2650,lng:-115.6500},
      {n:"Luxor Pyramid",lat:36.0965,lng:-115.1769},
      {n:"Whiskey Pete's",lat:35.6167,lng:-115.3900},
      {n:"Primm Valley Resort",lat:35.6160,lng:-115.3900},
      {n:"Westgate (Vault 21)",lat:36.1311,lng:-115.1564},
      {n:"Coca Cola Store",lat:36.1025,lng:-115.1738},
      {n:"Nellis Solar Array",lat:36.2460,lng:-115.0320},
      {n:"Ivanpah Solar",lat:35.2000,lng:-115.4667},
      {n:"Cottonwood Cove",lat:35.9990,lng:-114.5000},
      {n:"Vault 34 (Lake Mead)",lat:36.1750,lng:-114.7500},
      {n:"Jacobstown",lat:36.3000,lng:-115.6500},
      {n:"Dead Wind Cavern",lat:35.8000,lng:-115.4000},
      {n:"REPCONN Headquarters",lat:36.0500,lng:-115.1000},
      {n:"188 Trading Post",lat:35.9500,lng:-115.2000},
      {n:"Griffin Wares Caravan",lat:35.9000,lng:-115.2500},
      {n:"Nevada Highway Patrol",lat:35.9500,lng:-115.1500},
      {n:"Sunset Sarsaparilla HQ",lat:36.0000,lng:-115.2000},
      {n:"HELIOS One Entrance",lat:35.7600,lng:-114.9500},
      {n:"Camp Searchlight Church",lat:35.4600,lng:-114.9200},
      {n:"Quarry Junction",lat:35.9200,lng:-115.1800},
      {n:"Vikki & Vance Museum",lat:35.6150,lng:-115.3850},
      {n:"Mesquite Mountains",lat:35.8500,lng:-115.9500},
      {n:"Devil's Gullet",lat:35.7000,lng:-115.3000}];

// ———————————————————————— UI UPDATE ——————————————————
function updateUI() {
  document.getElementById("lvl").textContent = player.level;
  document.getElementById("xpText").textContent = player.xp;
  document.getElementById("xpMax").textContent = player.xpToNext;
  document.getElementById("xpBar").style.width = `${(player.xp / player.xpToNext)*100}%`;
  document.getElementById("hpText").textContent = `${player.hp}/${player.maxHp}`;
  document.getElementById("hpBar").style.width = `${(player.hp / player.maxHp)*100}%`;
  document.getElementById("caps").textContent = player.caps;

  // Stimpaks
  const count = player.stimpaks.length;
  document.getElementById("stimpakInventory").innerHTML = count > 0 
    ? `Stimpaks: ${count}` 
    : `<span style="color:#f66;">No Stimpaks</span>`;

  // Gear placeholder (expand later)
  document.getElementById("gearList").innerHTML = player.gear.length === 0
    ? `<p style="color:#666;">No gear yet — keep looting!</p>`
    : player.gear.map(g => `<div style="margin:8px 0;color:#ff9500;">${g}</div>`).join('');
}

// ———————————————————————— LOOT & LEVELING ————————————————————————
function claimLoot(spotName) {
  if (claimed.has(spotName)) {
    alert(`Already looted ${spotName}`);
    return;
  }
  claimed.add(spotName);

  player.caps += 50;
  player.xp += 20;

  // Level up?
  if (player.xp >= player.xpToNext) {
    player.level++;
    player.xp -= player.xpToNext;
    player.xpToNext = Math.round(player.xpToNext * 1.6);
    player.maxHp += 20;
    player.hp = player.maxHp;
    document.getElementById("newLevel").textContent = player.level;
    document.getElementById("levelUpOverlay").style.display = "flex";
  }

  document.getElementById("lootResult").textContent = `+50 CAPS • +20 XP`;
  document.getElementById("lootOverlay").style.display = "flex";
  updateUI();
}

function closeLoot() { document.getElementById("lootOverlay").style.display = "none"; }
function closeLevelUp() { document.getElementById("levelUpOverlay").style.display = "none"; }

// ———————————————————————— WALLET CONNECT (SAFE) ————————————————————————
document.getElementById("connectBtn").onclick = async () => {
  if (window.ethereum) {
    try {
      const accs = await ethereum.request({method:'eth_requestAccounts'});
      wallet = accs[0];
      document.getElementById("status").innerHTML = `<span style="color:#0f0;">ETH ${wallet.slice(0,6)}...${wallet.slice(-4)}</span>`;
    } catch(e) {}
  } else if (window.solana?.isPhantom) {
    try {
      const resp = await window.solana.connect();
      wallet = resp.publicKey.toString();
      document.getElementById("status").innerHTML = `<span style="color:#0f0;">SOL ${wallet.slice(0,6)}...${wallet.slice(-4)}</span>`;
    } catch(e) {}
  }

  if (!wallet) {
    wallet = "TEST_" + Math.random().toString(36).slice(2,9).toUpperCase();
    document.getElementById("status").innerHTML = `<span style="color:#0f0;">TEST MODE</span>`;
  }

  // Unlock everything
  document.getElementById("connectBtn").textContent = "CONNECTED";
  document.getElementById("connectBtn").disabled = true;
  document.getElementById("gpsBtn").disabled = false;
  document.getElementById("character").style.display = "block";
  document.getElementById("gearInventory").style.display = "block";
  document.getElementById("stimpakShop").style.display = "block";
  updateUI();
};

// ———————————————————————— MAP ————————————————————————
document.getElementById("gpsBtn").onclick = () => {
  document.getElementById("mainContainer").style.flex = "none";
  document.getElementById("mapContainer").style.display = "block";
  document.getElementById("backBtn").style.display = "block";

  map = L.map('map').setView([36.1146, -115.1728], 10);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '© OpenStreetMap'
  }).addTo(map);

  locations.forEach(loc => {
    const color = claimed.has(loc.n) ? "#444" : "#ff6200";
    L.circleMarker([loc.lat, loc.lng], {
      radius: 12,
      color: color,
      fillColor: color,
      fillOpacity: 0.9,
      weight: 4
    }).addTo(map)
      .bindPopup(`<b>${loc.n}</b><br>Click to loot`)
      .on('click', () => claimLoot(loc.n));
  });

  userMarker = L.circleMarker([36.1146, -115.1728], {radius:15,color:'#0f0',fillColor:'#0f0'}).addTo(map).bindPopup("YOU ARE HERE");
  document.getElementById("nearby").innerHTML = `<b>50 FALLOUT LOCATIONS LOADED</b><br>Tap orange circles • Green = You`;
};

function backToMain() {
  document.getElementById("mapContainer").style.display = "none";
  document.getElementById("backBtn").style.display = "none";
  document.getElementById("mainContainer").style.flex = "1";
  if (map) map.remove();
}

// ———————————————————————— STIMPAK SHOP ————————————————————————
document.getElementById("buyCommon").onclick = () => {
  if (player.caps < 100) return alert("Need 100 CAPS");
  player.caps -= 100;
  player.stimpaks.push("Stimpak");
  updateUI();
};

document.getElementById("buySuper").onclick = () => {
  if (player.caps < 500) return alert("Need 500 CAPS");
  player.caps -= 500;
  player.stimpaks.push("Super Stimpak");
  updateUI();
};

document.getElementById("reviveBtn").onclick = () => {
  if (player.stimpaks.length === 0) {
    alert("No stimpaks left — PERMANENT DEATH");
    location.reload();
    return;
  }
  const item = player.stimpaks.shift();
  if (item.includes("Super")) player.hp = player.maxHp;
  else player.hp = Math.min(player.maxHp, player.hp + 60);

  document.getElementById("deathOverlay").style.display = "none";
  updateUI();
  alert(`Revived with ${item}!`);
};

// Init
updateUI();
</script>
</body>
</html>
